import{f as O,d as L,b0 as D,n as k,Y as F,aI as oe,m as j,q as Z,aw as X,ay as te,j as c,p as E,aR as p,b9 as ae,bg as se,t as H,b5 as ne,ar as M,ak as $,aj as A,i as ie,o as le,aJ as ce,aK as re,ax as me,ae as q,b2 as ue,a9 as ve,a_ as de,b7 as ge,a5 as fe,b3 as he,aF as we,ag as Pe,bh as be,bi as Se,w as xe}from"./h5-ai-sport.v0.0.0.index.a6c8dc0f.1684379857111.js";import{S as Ie,a as ye}from"./h5-ai-sport.v0.0.0.index.a150fdf4.1684379857111.js";import{I as Ce}from"./h5-ai-sport.v0.0.0.index.92382d81.1684379857111.js";const B=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),N=O("image-preview")[1];var Te=L({props:{src:String,show:Boolean,active:Number,minZoom:D(k),maxZoom:D(k),rootWidth:D(Number),rootHeight:D(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(o,{emit:l,slots:r}){const e=F({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=oe(),w=j(),x=Z(()=>{const{rootWidth:t,rootHeight:n}=o,i=n/t;return e.imageRatio>i}),Y=Z(()=>{const{scale:t,moveX:n,moveY:i,moving:g,zooming:f}=e,R={transitionDuration:f||g?"0s":".3s"};if(t!==1){const Q=n/t,ee=i/t;R.transform=`scale(${t}, ${t}) translate(${Q}px, ${ee}px)`}return R}),m=Z(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:n}=o,i=x.value?n/e.imageRatio:t;return Math.max(0,(e.scale*i-t)/2)}return 0}),v=Z(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:n}=o,i=x.value?n:t*e.imageRatio;return Math.max(0,(e.scale*i-n)/2)}return 0}),I=t=>{t=p(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,l("scale",{scale:t,index:o.active}))},y=()=>{I(1),e.moveX=0,e.moveY=0},z=()=>{const t=e.scale>1?1:2;I(t),e.moveX=0,e.moveY=0};let h,P,b,C,T,a,d,u=!1;const U=t=>{const{touches:n}=t;if(h=n.length,h===2&&o.disableZoom)return;const{offsetX:i}=s;s.start(t),P=e.moveX,b=e.moveY,d=Date.now(),u=!1,e.moving=h===1&&e.scale!==1,e.zooming=h===2&&!i.value,e.zooming&&(C=e.scale,T=B(t.touches))},G=t=>{const{touches:n}=t;if(s.move(t),e.moving){const{deltaX:i,deltaY:g}=s,f=i.value+P,R=g.value+b;if((f>m.value||f<-m.value)&&!u){e.moving=!1;return}u=!0,E(t,!0),e.moveX=p(f,-m.value,m.value),e.moveY=p(R,-v.value,v.value)}if(e.zooming&&(E(t,!0),n.length===2)){const i=B(n),g=C*i/T;I(g)}},J=()=>{if(h>1)return;const{offsetX:t,offsetY:n}=s,i=Date.now()-d,g=250,f=5;t.value<f&&n.value<f&&(i<g?a?(clearTimeout(a),a=null,z()):a=setTimeout(()=>{l("close"),a=null},g):i>se&&l("longPress"))},_=t=>{let n=!1;(e.moving||e.zooming)&&(n=!0,e.moving&&P===e.moveX&&b===e.moveY&&(n=!1),t.touches.length||(e.zooming&&(e.moveX=p(e.moveX,-m.value,m.value),e.moveY=p(e.moveY,-v.value,v.value),e.zooming=!1),e.moving=!1,P=0,b=0,C=1,e.scale<1&&y(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),E(t,n),J(),s.reset()},V=t=>{const{naturalWidth:n,naturalHeight:i}=t.target;e.imageRatio=i/n};return X(()=>o.active,y),X(()=>o.show,t=>{t||y()}),te("touchmove",G,{target:Z(()=>{var t;return(t=w.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>c(ae,{type:"spinner"},null)};return c(Ie,{ref:w,class:N("swipe-item"),onTouchstartPassive:U,onTouchend:_,onTouchcancel:_},{default:()=>[r.image?c("div",{class:N("image-wrap")},[r.image({src:o.src})]):c(Ce,{src:o.src,fit:"contain",class:N("image",{vertical:x.value}),style:Y.value,onLoad:V},t)]})}}});const[Ze,S]=O("image-preview"),pe=["show","teleport","transition","overlayStyle","closeOnPopstate"],Xe={show:Boolean,loop:H,images:ne(),minZoom:M(1/3),maxZoom:M(3),overlay:H,closeable:Boolean,showIndex:H,className:$,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:$,overlayStyle:Object,swipeDuration:M(300),startPosition:M(0),showIndicators:Boolean,closeOnPopstate:H,closeIconPosition:A("top-right"),teleport:[String,Object]};var K=L({name:Ze,props:Xe,emits:["scale","close","closed","change","longPress","update:show"],setup(o,{emit:l,slots:r}){const e=j(),s=F({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),w=()=>{if(e.value){const a=de(e.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,e.value.resize()}},x=a=>l("scale",a),Y=a=>l("update:show",a),m=()=>{he(o.beforeClose,{args:[s.active],done:()=>Y(!1)})},v=a=>{a!==s.active&&(s.active=a,l("change",a))},I=()=>{if(o.showIndex)return c("div",{class:S("index")},[r.index?r.index({index:s.active}):`${s.active+1} / ${o.images.length}`])},y=()=>{if(r.cover)return c("div",{class:S("cover")},[r.cover()])},z=()=>{s.disableZoom=!0},h=()=>{s.disableZoom=!1},P=()=>c(ye,{ref:e,lazyRender:!0,loop:o.loop,class:S("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:v,onDragEnd:h,onDragStart:z},{default:()=>[o.images.map((a,d)=>c(Te,{src:a,show:o.show,active:s.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:x,onClose:m,onLongPress:()=>l("longPress",{index:d})},{image:r.image}))]}),b=()=>{if(o.closeable)return c(fe,{role:"button",name:o.closeIcon,class:[S("close-icon",o.closeIconPosition),ge],onClick:m},null)},C=()=>l("closed"),T=(a,d)=>{var u;return(u=e.value)==null?void 0:u.swipeTo(a,d)};return ie({swipeTo:T}),le(w),X([ce,re],w),X(()=>o.startPosition,a=>v(+a)),X(()=>o.show,a=>{const{images:d,startPosition:u}=o;a?(v(+u),me(()=>{w(),T(+u,{immediate:!0})})):l("close",{index:s.active,url:d[s.active]})}),()=>c(ve,q({class:[S(),o.className],overlayClass:[S("overlay"),o.overlayClass],onClosed:C,"onUpdate:show":Y},ue(o,pe)),{default:()=>[b(),P(),I(),y()]})}});let W;const Ye={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Re(){({instance:W}=be({setup(){const{state:o,toggle:l}=Se(),r=()=>{o.images=[]};return()=>c(K,q(o,{onClosed:r,"onUpdate:show":l}),null)}}))}const We=(o,l=0)=>{if(we)return W||Re(),o=Array.isArray(o)?{images:o,startPosition:l}:o,W.open(Pe({},Ye,o)),W};xe(K);export{We as s};
