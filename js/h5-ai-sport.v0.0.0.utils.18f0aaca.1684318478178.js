var g=(t,a,n)=>new Promise((e,o)=>{var r=s=>{try{c(n.next(s))}catch(h){o(h)}},l=s=>{try{c(n.throw(s))}catch(h){o(h)}},c=s=>s.done?e(s.value):Promise.resolve(s.value).then(r,l);c((n=n.apply(t,a)).next())});import{l as b,c as B,d as I,e as C}from"./h5-ai-sport.v0.0.0.bgAudio.2915f8b6.1684318478178.js";import{d as k,Y as M,m as v,o as E,T as F,U as H,Z as T,c as R,e as S,v as A,z as j,_ as q}from"./h5-ai-sport.v0.0.0.index.95bda2e2.1684318478178.js";const W={id:"camera"},z=["width","height"],L=["width","height"],U=k({__name:"CameraModel",emits:["update","error"],setup(t,{emit:a}){const n=M({transform:"scaleX(-1)",objectFit:"cover"}),e=M({width:document.body.clientWidth,height:document.body.clientHeight}),o=v(0),r=v(!1);let l,c;E(()=>g(this,null,function*(){F("模型加载中..."),l=yield b(),yield s()}));const s=()=>g(this,null,function*(){let i=document.getElementById("video"),m={audio:!1,video:{width:640,height:480,facingMode:"user"}};try{c=yield navigator.mediaDevices.getUserMedia(m),i.srcObject=c,i.setAttribute("webkit-playsinline",!0),i.setAttribute("playsinline",!0),i.play(),yield new Promise(d=>{i.onloadedmetadata=()=>{d(i)}}),yield h()}catch(d){console.log("%c [ error ]-62","font-size:13px; background:pink; color:#bf2c9f;",d)}}),h=()=>g(this,null,function*(){yield _(),o.value=yield requestAnimationFrame(h),yield H()}),_=()=>g(this,null,function*(){const i=document.getElementById("video"),d=document.getElementById("output").getContext("2d");try{let f=yield B(l,i,d,e.width,e.height),w=f[0].keypoints;w.length>0&&r.value&&(d.scale(-1,1),d.translate(e.width,0),d.drawImage(i,0,0,e.width,e.height),d.clearRect(0,0,e.width,e.height),I(w,d),C(w,d)),a("update",f)}catch(f){a("error",f)}});return T(()=>{c&&(c.getTracks().forEach(i=>i.stop()),c=void 0),cancelAnimationFrame(o.value)}),(i,m)=>(R(),S("div",W,[A("video",{id:"video",class:"camera-video",style:j(n),width:e.width,height:e.height,"webkit-playsinline":"true",playsinline:"true"},null,12,z),A("canvas",{class:"camera-output",id:"output",width:e.width,height:e.height},null,8,L)]))}});const V=q(U,[["__scopeId","data-v-da9e2844"]]);let y=0;function D(t){const a=p(t[13],t[11],t[15]);return p(t[14],t[12],t[16])>160&&a>160?y++:y=0,y>2?(y=0,!0):!1}function p(t,a,n){const e=t,o=a,r=n,l=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)),c=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)),s=Math.sqrt(Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)),h=(Math.pow(l,2)+Math.pow(c,2)-Math.pow(s,2))/(2*l*c);return Math.round(Math.acos(h)*180/Math.PI)}function X(t){const a=x(t[11],t[15]),n=x(t[12],t[16]);return a+n}function x(t,a){const n=t,e=a,o=Math.abs(n.y-e.y),r=Math.abs(n.x-e.x);return Math.round(Math.atan(r/o)/(Math.PI/180))}function Z(t,a){const n=Math.abs(t.x-a.x),e=Math.abs(t.y-a.y);return Math.round(Math.atan(e/n)/(Math.PI/180))}const u=[];function G(t){return u.length>400?u.splice(0,Math.floor(u.length/2)):u.push(t),u}function K(t,a){let n=!0;const e=20,o=document.body.clientWidth,r=document.body.clientHeight,l=o/2-r*.2,c=o-l;return Array.isArray(a)&&Array.isArray(t)&&a.forEach(s=>{(!t[s]||t[s].x<l-e||t[s].x>c+e||t[s].y>r*.9||t[s].y<r*.15)&&(n=!1)}),n}function O(t){const a=u.slice(-5);if(a.length===5){let n=0;return a.forEach(e=>{K(e,t)&&n++}),n>=3}else return!1}function P(t,a,n){if(Array.isArray(t)&&a&&Array.isArray(n)){let e=!0;return n.forEach(o=>{(!t[o]||t[o].score<a)&&(e=!1)}),e}else return!1}function Q(t,a,n){return D(t)&&P(t,a,n)&&O(n)}function $(t){const a=Math.atan(t)/(Math.PI/180);return Math.round(a)}export{V as _,p as a,P as b,Q as c,Z as d,$ as g,O as i,G as s,X as t};
